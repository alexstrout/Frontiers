Code "Allow Homing Attack" in "Gameplay/Skills/Tails" by "fox, Susero, Hyper" does
/*
Allows Tails to Homing Attack locked targets.

Toggle Spanner Throw with L3 (Light Dash) button.
*/

#include "Reflection" noemit
#lib "HMM"
#lib "Logger"
#lib "Time"

const string FX_HANDLE = "TailsHomingSwapFx";

static HashSet<Tails.StateID> HomingStates = new()
{
    Tails.StateID.StateHomingAttack,
    Tails.StateID.StateHomingAttackInStorm,
    Tails.StateID.StateHomingRepelled
};

static bool InitConfig = true;
static bool CfgAllowToggle = true;
static bool CfgAllowEnemies = true;
static bool CfgSpannerReminder = true;

static bool HomingActive = true;

static float HomingDownTime;
static Tails.StateID PrevState;
static GameObject.Data* PrevLockOnTarget;

{
    //Ignore if not Tails
    if (Player.GetPlayerType() != Player.PlayerType.Tails)
        return;

    //Configuration support
    if (InitConfig)
    {
        //Do only once - TODO maybe this can just be Patch code w/ statics
        InitConfig = false;

        //Avoid crashing the game if config is missing or malformed
        try {
            var modsQuery = HMM.FindModsByName("Tails Smart Homing Attack");
            if (modsQuery.Count == 1)
            {
                string modConfigIniPath = System.IO.Path.Combine(modsQuery[0].Path, "config.ini");
                var ini = INI.Read(modConfigIniPath);

                CfgAllowToggle = INI.Parse<bool>(ini["ModSettings"]["ModeToggleOnL3"], CfgAllowEnemies);
                CfgAllowEnemies = INI.Parse<bool>(ini["ModSettings"]["HomingAttackEnemies"], CfgAllowEnemies);
                CfgSpannerReminder = INI.Parse<bool>(ini["ModSettings"]["SpannerLockOnSound"], CfgSpannerReminder);
            }
        }
        catch (Exception e) {
            Logger.Error("TailsSmartHoming: Error reading config, try configuring the mod in HMM! Details:");
            Logger.Error(e);
        }
    }

    //Homing Attack / Spanner Throw mode toggle
    if (CfgAllowToggle && Player.Input.IsPressed(Player.InputActionType.PlayerLightDash))
    {
        HomingActive = !HomingActive;
        if (HomingActive)
        {
            //TODO These look a derpy at feet - can they be moved?
            Player.Sound.PlaySound("sn_short_homing");
            Player.Effect.PlayEffect(FX_HANDLE, "ef_tap_spinatk01_end01");
        }
        else
        {
            Player.Sound.PlaySound("ta_spanner_hit");
            Player.Effect.PlayEffect(FX_HANDLE, "ef_tap_spanner_throw_end01");
        }
    }

    //State tracking - determine HomingDownTime if we just bopped an enemy
    var CurState = Player.State.GetCurrentStateID<Tails.StateID>();
    if (CurState == Tails.StateID.StateHomingFinished && CurState != PrevState)
    {
        //Use Sonic parameters as Tails by default has no Cyberspace definition
        //Players probably reasonably expect homing behavior to match Sonic's anyhow
        //HACK Fudging a magic 0.2f to more closely match other characters' cadence - another var?
        var ParamInfo = Reflection.GetDataInfo<SonicParameters.Root>("player_common")
        if (ParamInfo != null && ParamInfo.pData != null)
            HomingDownTime = RFL_GET_CONTEXTUAL_PLAYER_PARAM(ParamInfo, modePackage.homingAttack.sonicBounce.attackDownTime) + 0.2f;
    }
    PrevState = CurState;

    //Decrement HomingDownTime...
    if (HomingDownTime > 0f)
    {
        HomingDownTime -= Time.GetDeltaTime();
        if (HomingDownTime < 0f)
            HomingDownTime = 0f;
    }

    //Lock-on tracking
    var LockOnTarget = Player.Status.GetLockOnTarget();
    if (LockOnTarget != null)
    {
        //Play spanner bonk if desired to remind us which mode we're in
        if (CfgSpannerReminder && LockOnTarget != PrevLockOnTarget && !HomingActive)
            Player.Sound.PlaySound("ta_spanner_hit");

        //Bop that target! Nyooom
        //TODO GOCHealth is used to determine enemies, but inconsistent (e.g. Cyberspace) - better method?
        if (HomingActive && HomingDownTime == 0f
        && Player.Input.IsPressed(Player.InputActionType.PlayerAttack)
        && (CfgAllowEnemies || GameObject.GetGOC(LockOnTarget, "GOCHealth") == null)
        && !(IS_WORLD_FLAG(IsDamagedOrRepelled) || HomingStates.Contains(CurState)))
            Player.State.SetState<Tails.StateID>(Tails.StateID.StateHomingAttack);
    }
    PrevLockOnTarget = LockOnTarget;
}
